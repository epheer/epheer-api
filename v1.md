# Документация по API v1

## URL версии `/v1`

## Содержание

1. [Аутентификация](#аутентификация)
2. [Пользователи](#пользователи)
3. [Артисты](#артисты)
4. [Менеджеры](#менеджеры)
5. [Медиафайлы](#медиафайлы)
6. [Релизы](#релизы)
7. [Треки](#треки)
8. [Примечания к релизам](#примечания-к-релизу)
9. [Файлы документов](#файлы-документов)
10. [Договоры](#договоры)
11. [Роялти](#роялти)

---

# Аутентификация <a id="аутентификация"></a>

## Базовый URL `/auth`

## Содержание

1. [Регистрация нового пользователя](#1-регистрация-нового-пользователя)
2. [Вход в систему](#2-вход-в-систему)
3. [Выход из системы](#3-выход-из-системы)
4. [Обновление токена](#4-обновление-токена)
5. [Деактивация аккаунта пользователя](#5-деактивация-аккаунта-пользователя)
6. [Разблокировка аккаунта пользователя](#6-разблокировка-аккаунта-пользователя)
7. [Изменение пароля](#7-изменение-пароля)
8. [Изменение email](#8-изменение-email)

---

## 1. Регистрация нового пользователя <a id="1-регистрация-нового-пользователя"></a>

**Описание**: Этот эндпоинт используется для регистрации нового пользователя в системе. Доступен только пользователям с ролью `root`.

- **Путь**: `/register`
- **Метод**: `POST`
- **Уровень доступа**: `root`
- **Тело запроса**:
  ```json
  {
    "login": "string",
    "password": "string",
    "role": "root | manager | artist",
    "email": "string"
  }
  ```
- **Правила валидации**:

  - `login`: Обязательное поле, уникальное, без пробелов.
  - `password`: Обязательное поле.
  - `role`: Должно быть одним из значений: `root`, `manager`, `artist`.
  - `email`: Необязательное поле.

- **Ответ при успехе**:

  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "user": {
        "id": "string",
        "login": "string",
        "role": "root | manager | artist"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Пользователь с логином <login> уже существует"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```

---

## 2. Вход в систему <a id="2-вход-в-систему"></a>

**Описание**: Этот эндпоинт используется для аутентификации пользователя в системе. После успешного входа возвращаются токены доступа и информация о пользователе.

- **Путь**: `/login`
- **Метод**: `POST`
- **Уровень доступа**: Публичный
- **Тело запроса**:
  ```json
  {
    "login": "string",
    "password": "string"
  }
  ```
- **Правила валидации**:

  - `login`: Обязательное поле.
  - `password`: Обязательное поле.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "accessToken": "string",
      "refreshToken": "string",
      "user": {
        "id": "string",
        "login": "string",
        "role": "root | manager | artist"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверный логин или пароль"
    }
    ```
  - **400 Bad Request**:
    ```json
    {
      "message": "Ваш аккаунт заблокирован"
    }
    ```

---

## 3. Выход из системы <a id="3-выход-из-системы"></a>

**Описание**: Этот эндпоинт используется для выхода пользователя из системы. При этом refresh token удаляется.

- **Путь**: `/logout`
- **Метод**: `POST`
- **Уровень доступа**: Нет (требуется валидный refresh token в cookies)
- **Тело запроса**: Нет
- **Cookies**:

  - `refreshToken`: Валидный refresh token.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Токен успешно удален"
    }
    ```

- **Ответы при ошибках**:
  - **401 Unauthorized**:
    ```json
    {
      "message": "Пользователь не авторизован"
    }
    ```

---

## 4. Обновление токена <a id="4-обновление-токена"></a>

**Описание**: Этот эндпоинт используется для обновления токенов доступа. Требуется валидный refresh token.

- **Путь**: `/refresh`
- **Метод**: `GET`
- **Уровень доступа**: Нет (требуется валидный refresh token в cookies)
- **Тело запроса**: Нет
- **Cookies**:

  - `refreshToken`: Валидный refresh token.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "accessToken": "string",
      "refreshToken": "string",
      "user": {
        "id": "string",
        "login": "string",
        "role": "root | manager | artist"
      }
    }
    ```

- **Ответы при ошибках**:
  - **401 Unauthorized**:
    ```json
    {
      "message": "Пользователь не авторизован"
    }
    ```

---

## 5. Деактивация аккаунта пользователя <a id="5-деактивация-аккаунта-пользователя"></a>

**Описание**: Этот эндпоинт используется для деактивации аккаунта пользователя. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/deactivate`
- **Метод**: `POST`
- **Уровень доступа**: `root`
- **Параметры пути**:

  - `id`: ID пользователя для деактивации.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Аккаунт пользователя <id> деактивирован"
    }
    ```

- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

## 6. Разблокировка аккаунта пользователя <a id="6-разблокировка-аккаунта-пользователя"></a>

**Описание**: Этот эндпоинт используется для разблокировки аккаунта пользователя. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/unblock`
- **Метод**: `POST`
- **Уровень доступа**: `root`
- **Параметры пути**:

  - `id`: ID пользователя для разблокировки.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Аккаунт пользователя <id> разблокирован"
    }
    ```

- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

## 7. Изменение пароля <a id="7-изменение-пароля"></a>

**Описание**: Этот эндпоинт используется для изменения пароля пользователя. Доступен только владельцу аккаунта или администратору.

- **Путь**: `/:id/password`
- **Метод**: `PUT`
- **Уровень доступа**: `personal`
- **Параметры пути**:
  - `id`: ID пользователя, чей пароль изменяется.
- **Тело запроса**:
  ```json
  {
    "password": "string"
  }
  ```
- **Правила валидации**:

  - `password`: Обязательное поле.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Пароль успешно изменен"
    }
    ```

- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

## 8. Изменение email <a id="8-изменение-email"></a>

**Описание**: Этот эндпоинт используется для изменения email пользователя. Доступен только владельцу аккаунта или администратору.

- **Путь**: `/:id/email`
- **Метод**: `PUT`
- **Уровень доступа**: `personal`
- **Параметры пути**:
  - `id`: ID пользователя, чей email изменяется.
- **Тело запроса**:
  ```json
  {
    "email": "string"
  }
  ```
- **Правила валидации**:

  - `email`: Обязательное поле.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Email успешно изменен"
    }
    ```

- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

# Пользователи <a id="пользователи"></a>

## Базовый URL `/users`

## Содержание

1. [Обновление информации о пользователе](#1-обновление-информации-о-пользователе)
2. [Получение информации о пользователях по ID](#2-получение-информации-о-пользователях-по-id)
3. [Получение списка всех пользователей](#3-получение-списка-всех-пользователей)

---

## 1. Обновление информации о пользователе <a id="1-обновление-информации-о-пользователе"></a>

**Описание**: Этот эндпоинт используется для обновления персональной информации о пользователе. Доступен только владельцу аккаунта или администратору.

- **Путь**: `/:id`
- **Метод**: `PUT`
- **Уровень доступа**: `personal` (через `access("personal")`)
- **Параметры пути**:
  - `id`: ID пользователя, чья информация обновляется.
- **Тело запроса**:
  ```json
  {
    "surname": "string",
    "firstname": "string",
    "patronymic": "string",
    "contact": "string"
  }
  ```
- **Правила валидации**:

  - `surname`: Обязательное поле.
  - `firstname`: Обязательное поле.
  - `patronymic`: Необязательное поле.
  - `contact`: Обязательное поле.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "surname": "string",
      "firstname": "string",
      "patronymic": "string",
      "contact": "string"
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Отсутствуют обязательные поля"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Пользователь не найден"
    }
    ```

---

## 2. Получение информации о пользователях по ID <a id="2-получение-информации-о-пользователях-по-id"></a>

**Описание**: Этот эндпоинт используется для получения информации о пользователях по их ID. Доступен только пользователям с ролью `label`.

- **Путь**: `/:ids`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:

  - `ids`: Список ID пользователей, разделенных запятыми (например, `1,2,3`).

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    [
      {
        "id": "string",
        "login": "string",
        "role": "root | manager | artist",
        "surname": "string",
        "firstname": "string",
        "patronymic": "string",
        "contact": "string",
        "email": "string",
        "is_active": "boolean",
        "createdAt": "date"
      }
    ]
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверный формат или пустой список ID пользователей"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```

---

## 3. Получение списка всех пользователей <a id="3-получение-списка-всех-пользователей"></a>

**Описание**: Этот эндпоинт используется для получения списка всех пользователей с возможностью фильтрации, сортировки и пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:

  - `filter[role]`: Фильтр по роли пользователя (`root`, `manager`, `artist`).
  - `search`: Поисковый запрос (поиск по логину, email, фамилии, имени, контакту).
  - `sort[createdAt]`: Сортировка по дате создания (`asc` или `desc`).
  - `sort[role]`: Сортировка по роли (`asc` или `desc`).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "id": "string",
          "login": "string",
          "role": "root | manager | artist",
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string",
          "email": "string",
          "is_active": "boolean",
          "createdAt": "date"
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```

---

# Артисты <a id="артисты"></a>

## Базовый URL `/artists`

## Содержание

1. [Обновление сценического имени артиста](#1-обновление-сценического-имени-артиста)
2. [Привязка менеджера к артисту](#2-привязка-менеджера-к-артисту)
3. [Получение информации об артистах по ID](#3-получение-информации-об-артистах-по-id)
4. [Получение списка всех артистов](#4-получение-списка-всех-артистов)

---

## 1. Обновление сценического имени артиста <a id="1-обновление-сценического-имени-артиста"></a>

**Описание**: Этот эндпоинт используется для обновления сценического имени артиста. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/name`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID пользователя, чье сценическое имя обновляется.
- **Тело запроса**:
  ```json
  {
    "stageName": "string"
  }
  ```
- **Правила валидации**:

  - `stageName`: Обязательное поле, строка.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "stage_name": "string",
      "surname": "string",
      "firstname": "string",
      "patronymic": "string",
      "contact": "string",
      "manager": {
        "surname": "string",
        "firstname": "string",
        "patronymic": "string",
        "contact": "string"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Имя артиста должно быть строкой"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Артист не найден"
    }
    ```

---

## 2. Привязка менеджера к артисту <a id="2-привязка-менеджера-к-артисту"></a>

**Описание**: Этот эндпоинт используется для привязки менеджера к артисту. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/manager`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста, которому назначается менеджер.
- **Тело запроса**:
  ```json
  {
    "managerId": "string"
  }
  ```
- **Правила валидации**:

  - `managerId`: Обязательное поле, ID пользователя с ролью `manager` или `root`.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "stage_name": "string",
      "surname": "string",
      "firstname": "string",
      "patronymic": "string",
      "contact": "string",
      "manager": {
        "surname": "string",
        "firstname": "string",
        "patronymic": "string",
        "contact": "string"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Указанный пользователь не является менеджером"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Артист не найден"
    }
    ```

---

## 3. Получение информации об артистах по ID <a id="3-получение-информации-об-артистах-по-id"></a>

**Описание**: Этот эндпоинт используется для получения информации об артистах по их ID. Доступен только пользователям с ролью `label`.

- **Путь**: `/:ids`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:

  - `ids`: Список ID артистов, разделенных запятыми (например, `1,2,3`).

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    [
      {
        "id": "string",
        "stage_name": "string",
        "surname": "string",
        "firstname": "string",
        "patronymic": "string",
        "contact": "string",
        "manager": {
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string"
        }
      }
    ]
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверный формат списка ID артистов"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```

---

## 4. Получение списка всех артистов <a id="4-получение-списка-всех-артистов"></a>

**Описание**: Этот эндпоинт используется для получения списка всех артистов с возможностью фильтрации, сортировки и пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:

  - `filter[managerId]`: Фильтр по ID менеджера.
  - `search`: Поисковый запрос (поиск по сценическому имени, фамилии, имени).
  - `sort[stage_name]`: Сортировка по сценическому имени (`asc` или `desc`).
  - `sort[surname]`: Сортировка по фамилии (`asc` или `desc`).
  - `sort[firstname]`: Сортировка по имени (`asc` или `desc`).
  - `sort[createdAt]`: Сортировка по дате создания (`asc` или `desc`).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "id": "string",
          "stage_name": "string",
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string",
          "manager": {
            "surname": "string",
            "firstname": "string",
            "patronymic": "string",
            "contact": "string"
          }
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```

---

# Менеджеры <a id="менеджеры"></a>

## Базовый URL `/managers`

## Содержание

1. [Получение списка артистов, закрепленных за менеджером](#1-получение-списка-артистов-закрепленных-за-менеджером)
2. [Получение списка всех менеджеров](#2-получение-списка-всех-менеджеров)

---

## 1. Получение списка артистов, закрепленных за менеджером <a id="1-получение-списка-артистов-закрепленных-за-менеджером"></a>

**Описание**: Этот эндпоинт используется для получения списка артистов, закрепленных за конкретным менеджером. Доступен только пользователям с ролью `manager`.

- **Путь**: `/:id/artists`
- **Метод**: `GET`
- **Уровень доступа**: `manager` (через `access("manager")`)
- **Параметры пути**:

  - `id`: ID менеджера, чьи артисты запрашиваются.

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    [
      {
        "id": "string",
        "stage_name": "string",
        "surname": "string",
        "firstname": "string",
        "patronymic": "string",
        "contact": "string",
        "manager": {
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string"
        }
      }
    ]
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверный формат запроса"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Артисты не найдены"
    }
    ```

---

## 2. Получение списка всех менеджеров <a id="2-получение-списка-всех-менеджеров"></a>

**Описание**: Этот эндпоинт используется для получения списка всех менеджеров с возможностью фильтрации, сортировки и пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:

  - `search`: Поисковый запрос (поиск по фамилии или имени).
  - `sort[surname]`: Сортировка по фамилии (`asc` или `desc`).
  - `sort[firstname]`: Сортировка по имени (`asc` или `desc`).
  - `sort[createdAt]`: Сортировка по дате создания (`asc` или `desc`).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).

- **Ответ при успехе**:

  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "id": "string",
          "role": "root | manager",
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string"
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```

- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Менеджеры не найдены"
    }
    ```

---

# Медиафайлы <a id="медиафайлы"></a>

## Базовый URL `/media`

## Содержание

1. [Загрузка обложки релиза](#1-загрузка-обложки-релиза)
2. [Загрузка трека](#2-загрузка-трека)
3. [Получение обложки релиза](#3-получение-обложки-релиза)
4. [Получение трека](#4-получение-трека)
5. [Скачивание файла](#5-скачивание-файла)
6. [Удаление файла](#6-удаление-файла)

---

## 1. Загрузка обложки релиза <a id="1-загрузка-обложки-релиза"></a>

**Описание**: Этот эндпоинт используется для загрузки обложки релиза. Обложка должна быть в формате JPG с размером 3000x3000 пикселей.

- **Путь**: `/:id/releases/:releaseId/cover`
- **Метод**: `POST`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
- **Тело запроса**:
  - **Формат**: `multipart/form-data`
  - **Параметры**:
    - `file`: Файл обложки (JPG, 3000x3000 пикселей).
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "message": "Обложка успешно загружена."
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Недопустимый формат или размер обложки."
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 2. Загрузка трека <a id="2-загрузка-трека"></a>

**Описание**: Этот эндпоинт используется для загрузки трека. Трек должен быть в формате WAV или FLAC с частотой дискретизации 44100–48000 Гц и глубиной 16 бит.

- **Путь**: `/:id/releases/:releaseId/track`
- **Метод**: `POST`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
- **Тело запроса**:
  - **Формат**: `multipart/form-data`
  - **Параметры**:
    - `file`: Файл трека (WAV или FLAC).
    - `trackNumber`: Порядковый номер трека (число).
    - `trackTitle`: Название трека (строка).
    - `fileType`: Тип файла (`wav` или `flac`).
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "message": "Трек успешно загружен."
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Недопустимый формат файла трека."
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 3. Получение обложки релиза <a id="3-получение-обложки-релиза"></a>

**Описание**: Этот эндпоинт используется для получения обложки релиза в разных размерах.

- **Путь**: `/:id/releases/:releaseId/cover/:size`
- **Метод**: `GET`
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
  - `size`: Размер обложки (`original`, `1200`, `600`).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**: Поток файла обложки (JPG).
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Недопустимый размер обложки."
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Обложка релиза не найдена."
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 4. Получение трека <a id="4-получение-трека"></a>

**Описание**: Этот эндпоинт используется для получения трека.

- **Путь**: `/:id/releases/:releaseId/track/:fileName`
- **Метод**: `GET`
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
  - `fileName`: Имя файла трека.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**: Поток файла трека (WAV или FLAC).
- **Ответы при ошибках**:
  - **404 Not Found**:
    ```json
    {
      "message": "Трек не найден."
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 5. Скачивание файла <a id="5-скачивание-файла"></a>

**Описание**: Этот эндпоинт используется для скачивания файла (обложки или трека).

- **Путь**: `/:id/releases/:releaseId/download/:fileName`
- **Метод**: `GET`
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
  - `fileName`: Имя файла.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**: Файл в виде буфера.
- **Ответы при ошибках**:
  - **404 Not Found**:
    ```json
    {
      "message": "Файл не найден."
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 6. Удаление файла <a id="6-удаление-файла"></a>

**Описание**: Этот эндпоинт используется для удаления файла (обложки или трека).

- **Путь**: `/:id/releases/:releaseId/delete/:fileName`
- **Метод**: `DELETE`
- **Параметры пути**:
  - `id`: ID артиста.
  - `releaseId`: ID релиза.
  - `fileName`: Имя файла.
- **Ответ при успехе**:
  - **Статус**: `204 No Content`
- **Ответы при ошибках**:
  - **404 Not Found**:
    ```json
    {
      "message": "Файл не найден."
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

# Релизы <a id="релизы"></a>

## Базовый URL `/releases`

## Содержание

1. [Создание релиза](#1-создание-релиза)
2. [Обновление релиза](#2-обновление-релиза)
3. [Сохранение релиза](#3-сохранение-релиза)
4. [Обновление статуса релиза](#4-обновление-статуса-релиза)
5. [Получение релиза по ID](#5-получение-релиза-по-id)
6. [Получение релизов по артистам](#6-получение-релизов-по-артистам)
7. [Получение всех релизов](#7-получение-всех-релизов)

---

## 1. Создание релиза <a id="1-создание-релиза"></a>

**Описание**: Этот эндпоинт используется для создания нового релиза. Релиз создается в статусе "черновик".

- **Путь**: `/:id/new`
- **Метод**: `POST`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "artist": {
        "stage_name": "string",
        "user_id": "string"
      }
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Черновик релиза уже существует, удалите его или продолжайте его редактирование"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 2. Обновление релиза <a id="2-обновление-релиза"></a>

**Описание**: Этот эндпоинт используется для обновления данных релиза.

- **Путь**: `/:id`
- **Метод**: `PUT`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `name`: Название релиза.
    - `type`: Тип релиза (`single`, `ep`, `album`).
    - `date`: Дата релиза.
    - `cover_key`: Ключ обложки.
    - `feat`: Список участников.
    - `authors`: Авторы (лирики и продюсеры).
    - `upc`: UPC-код.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "artist": {
        "stageName": "string",
        "userId": "string"
      },
      "name": "string",
      "type": "string",
      "cover": "string",
      "date": "string",
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "status": {
        "label": "string",
        "message": "string",
        "history": [
          {
            "editor": "string",
            "status": {
              "label": "string",
              "message": "string"
            }
          }
        ]
      },
      "tracks": [
        {
          "id": "string",
          "title": "string",
          "duration": "number"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Некорректный запрос"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 3. Сохранение релиза <a id="3-сохранение-релиза"></a>

**Описание**: Этот эндпоинт используется для сохранения релиза и перевода его в статус "ожидание".

- **Путь**: `/:id`
- **Метод**: `PATCH`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "artist": {
        "stageName": "string",
        "userId": "string"
      },
      "name": "string",
      "type": "string",
      "cover": "string",
      "date": "string",
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "status": {
        "label": "string",
        "message": "string",
        "history": [
          {
            "editor": "string",
            "status": {
              "label": "string",
              "message": "string"
            }
          }
        ]
      },
      "tracks": [
        {
          "id": "string",
          "title": "string",
          "duration": "number"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Отсутствует обязательное поле"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 4. Обновление статуса релиза <a id="4-обновление-статуса-релиза"></a>

**Описание**: Этот эндпоинт используется для обновления статуса релиза.

- **Путь**: `/:id/status`
- **Метод**: `PATCH`
- **Уровень доступа**: `manager` (через `access("manager")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `status`: Новый статус (`draft`, `pending`, `approved`, `rejected`, `delivered`, `finalized`).
    - `userId`: ID пользователя, изменяющего статус.
    - `message`: Сообщение (опционально).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "artist": {
        "stageName": "string",
        "userId": "string"
      },
      "name": "string",
      "type": "string",
      "cover": "string",
      "date": "string",
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "status": {
        "label": "string",
        "message": "string",
        "history": [
          {
            "editor": "string",
            "status": {
              "label": "string",
              "message": "string"
            }
          }
        ]
      },
      "tracks": [
        {
          "id": "string",
          "title": "string",
          "duration": "number"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Недопустимый статус релиза"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 5. Получение релиза по ID <a id="5-получение-релиза-по-id"></a>

**Описание**: Этот эндпоинт используется для получения информации о релизе по его ID.

- **Путь**: `/:id`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "artist": {
        "stageName": "string",
        "userId": "string"
      },
      "name": "string",
      "type": "string",
      "cover": "string",
      "date": "string",
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "status": {
        "label": "string",
        "message": "string",
        "history": [
          {
            "editor": "string",
            "status": {
              "label": "string",
              "message": "string"
            }
          }
        ]
      },
      "tracks": [
        {
          "id": "string",
          "title": "string",
          "duration": "number"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 6. Получение релизов по артистам <a id="6-получение-релизов-по-артистам"></a>

**Описание**: Этот эндпоинт используется для получения списка релизов по ID артистов с возможностью фильтрации, сортировки и пагинации.

- **Путь**: `/artists/:ids`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `ids`: Список ID артистов, разделенных запятыми.
- **Query параметры**:
  - `filter[status]`: Фильтр по статусу релиза.
  - `sort[name]`: Сортировка по названию релиза (`asc` или `desc`).
  - `sort[stage_name]`: Сортировка по имени артиста (`asc` или `desc`).
  - `search`: Поисковый запрос (по названию релиза или имени артиста).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "id": "string",
          "artist": "string",
          "name": "string",
          "type": "string",
          "cover": "string",
          "date": "string",
          "feat": ["string"],
          "status": "string"
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релизы не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

## 7. Получение всех релизов <a id="7-получение-всех-релизов"></a>

**Описание**: Этот эндпоинт используется для получения списка всех релизов с возможностью фильтрации, сортировки и пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:
  - `filter[status]`: Фильтр по статусу релиза.
  - `sort[name]`: Сортировка по названию релиза (`asc` или `desc`).
  - `sort[stage_name]`: Сортировка по имени артиста (`asc` или `desc`).
  - `search`: Поисковый запрос (по названию релиза или имени артиста).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "id": "string",
          "artist": "string",
          "name": "string",
          "type": "string",
          "cover": "string",
          "date": "string",
          "feat": ["string"],
          "status": "string"
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релизы не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка сервера"
    }
    ```

---

# Треки <a id="треки"></a>

## Базовый URL `/tracks`

## Содержание

1. [Создание трека](#1-создание-трека)
2. [Обновление трека](#2-обновление-трека)
3. [Изменение порядка треков](#3-изменение-порядка-треков)
4. [Удаление трека](#4-удаление-трека)

---

## 1. Создание трека <a id="1-создание-трека"></a>

**Описание**: Этот эндпоинт используется для создания нового трека в релизе. Трек создается только для релизов со статусом "черновик".

- **Путь**: `/:id`
- **Метод**: `POST`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `fileKey`: Ключ файла трека в хранилище.
    - `duration`: Длительность трека в секундах.
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "_id": "string",
      "release": "string",
      "index": "number",
      "name": "string",
      "file": {
        "key": "string",
        "duration": "number"
      },
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "lyrics": {
        "text": "string",
        "ttml_key": "string"
      },
      "explicit": "boolean",
      "isrc": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Действие разрешено только для релизов со статусом 'черновик'"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при создании трека"
    }
    ```

---

## 2. Обновление трека <a id="2-обновление-трека"></a>

**Описание**: Этот эндпоинт используется для обновления данных трека. Трек может быть обновлен только для релизов со статусом "черновик".

- **Путь**: `/:id/:trackId`
- **Метод**: `PUT`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
  - `trackId`: ID трека.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `name`: Название трека.
    - `feat`: Список участников.
    - `authors`: Авторы (лирики и продюсеры).
    - `lyrics`: Текст или ключ TTML-файла.
    - `explicit`: Флаг "эксплицитного" содержания.
    - `isrc`: ISRC-код.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "_id": "string",
      "release": "string",
      "index": "number",
      "name": "string",
      "file": {
        "key": "string",
        "duration": "number"
      },
      "feat": ["string"],
      "authors": {
        "lyricists": ["string"],
        "producers": ["string"]
      },
      "lyrics": {
        "text": "string",
        "ttml_key": "string"
      },
      "explicit": "boolean",
      "isrc": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Действие разрешено только для релизов со статусом 'черновик'"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Трек не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при обновлении трека"
    }
    ```

---

## 3. Изменение порядка треков <a id="3-изменение-порядка-треков"></a>

**Описание**: Этот эндпоинт используется для изменения порядка треков в релизе. Доступен только для релизов со статусом "черновик".

- **Путь**: `/:id`
- **Метод**: `PATCH`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `newOrder`: Новый порядок треков (массив ID треков).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Порядок треков успешно обновлен"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Новый порядок треков не может быть пустым"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при изменении порядка треков"
    }
    ```

---

## 4. Удаление трека <a id="4-удаление-трека"></a>

**Описание**: Этот эндпоинт используется для удаления трека из релиза. Доступен только для релизов со статусом "черновик".

- **Путь**: `/:id/:trackId`
- **Метод**: `DELETE`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
  - `trackId`: ID трека.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Трек успешно удален"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Действие разрешено только для релизов со статусом 'черновик'"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Трек не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при удалении трека"
    }
    ```

---

# Примечания к релизу <a id="примечания-к-релизу"></a>

## Базовый URL `/notes`

## Содержание

1. [Обновление или создание примечания](#1-обновление-или-создание-примечания)
2. [Получение примечания по ID релиза](#2-получение-примечания-по-id-релиза)

---

## 1. Обновление или создание примечания <a id="1-обновление-или-создание-примечания"></a>

**Описание**: Этот эндпоинт используется для обновления или создания примечания к релизу. Примечания можно обновлять только для релизов, находящихся в статусах, отличных от "черновик" и "завершен".

- **Путь**: `/:id`
- **Метод**: `PUT`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `focus_tracks`: Список ID треков, на которые нужно обратить внимание.
    - `pitched`: Список строк, описывающих питчи.
    - `comment`: Текстовый комментарий.
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "_id": "string",
      "release_id": "string",
      "focus_tracks": ["string"],
      "pitched": ["string"],
      "comment": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Можно обновлять примечания только в релизах, находящихся в обработке."
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Релиз не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при обновлении/создании заметки"
    }
    ```

---

## 2. Получение примечания по ID релиза <a id="2-получение-примечания-по-id-релиза"></a>

**Описание**: Этот эндпоинт используется для получения примечания к релизу по его ID.

- **Путь**: `/:id`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID релиза.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "release_id": "string",
      "focus_tracks": ["string"],
      "pitched": ["string"],
      "comment": "string"
    }
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Примечаний ещё нет"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Произошла ошибка при получении заметки"
    }
    ```

---

# Файлы документов <a id="файлы-документов"></a>

## Базовый URL `/docs`

## Содержание

1. [Загрузка документа](#1-загрузка-документа)
2. [Скачивание документа](#2-скачивание-документа)
3. [Удаление документа](#3-удаление-документа)

---

## 1. Загрузка документа <a id="1-загрузка-документа"></a>

**Описание**: Этот эндпоинт используется для загрузки документа (например, контракта или квитанции) в формате PDF. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/:type/:documentId`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
  - `type`: Тип документа (`contract` или `receipt`).
  - `documentId`: ID документа.
- **Тело запроса**:
  - **Формат**: `multipart/form-data`
  - **Параметры**:
    - `file`: Файл документа (PDF, до 10 МБ).
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "message": "Документ успешно загружен."
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Файл не был загружен"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **409 Conflict**:
    ```json
    {
      "message": "Файл уже существует"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при работе с файлом"
    }
    ```

---

## 2. Скачивание документа <a id="2-скачивание-документа"></a>

**Описание**: Этот эндпоинт используется для скачивания документа. Доступен только пользователям с ролью `label`.

- **Путь**: `/:id/:type/:documentId`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
  - `type`: Тип документа (`contract` или `receipt`).
  - `documentId`: ID документа.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**: Поток файла документа (PDF).
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Документ не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при работе с файлом"
    }
    ```

---

## 3. Удаление документа <a id="3-удаление-документа"></a>

**Описание**: Этот эндпоинт используется для удаления документа. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/:type/:documentId`
- **Метод**: `DELETE`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
  - `type`: Тип документа (`contract` или `receipt`).
  - `documentId`: ID документа.
- **Ответ при успехе**:
  - **Статус**: `204 No Content`
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Документ не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при работе с файлом"
    }
    ```

---

# Договоры <a id="договоры"></a>

## Базовый URL `/contracts`

## Содержание

1. [Создание договора](#1-создание-договора)
2. [Создание приложения к договору](#2-создание-приложения-к-договору)
3. [Обновление договора](#3-обновление-договора)
4. [Обновление приложения к договору](#4-обновление-приложения-к-договору)
5. [Создание расторжения договора](#5-создание-расторжения-договора)
6. [Подтверждение расторжения договора](#6-подтверждение-расторжения-договора)
7. [Получение договора по ID артиста](#7-получение-договора-по-id-артиста)
8. [Получение всех договоров](#8-получение-всех-договоров)

---

## 1. Создание договора <a id="1-создание-договора"></a>

**Описание**: Этот эндпоинт используется для создания нового договора с артистом. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `percentage`: Процент отчислений артисту (число от 0 до 100).
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "contract_number": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Регистрация договоров возможна только для артистов"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **409 Conflict**:
    ```json
    {
      "message": "Договор для этого артиста уже существует"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при создании договора"
    }
    ```

---

## 2. Создание приложения к договору <a id="2-создание-приложения-к-договору"></a>

**Описание**: Этот эндпоинт используется для создания приложения к договору. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/appendix`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "appendix_number": "string"
    }
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Договор не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при создании приложения"
    }
    ```

---

## 3. Обновление договора <a id="3-обновление-договора"></a>

**Описание**: Этот эндпоинт используется для обновления данных договора. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `percentage`: Процент отчислений артисту (число от 0 до 100).
    - `pdf_key`: Ключ PDF-файла договора.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist_id": "string",
      "surname": "string",
      "firstname": "string",
      "patronymic": "string",
      "contact": "string",
      "email": "string",
      "id": "string",
      "number": "string",
      "file": "string",
      "percentage": "number",
      "appendices": [
        {
          "id": "string",
          "type": "string",
          "number": "string",
          "file": "string"
        }
      ],
      "status": "string",
      "createdAt": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Нет данных для изменений"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Договор не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при обновлении договора"
    }
    ```

---

## 4. Обновление приложения к договору <a id="4-обновление-приложения-к-договору"></a>

**Описание**: Этот эндпоинт используется для обновления приложения к договору. Доступен только пользователям с ролью `root`.

- **Путь**: `/appendix/:appendixNumber`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `appendixNumber`: Номер приложения.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `pdf_key`: Ключ PDF-файла приложения.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "id": "string",
      "type": "string",
      "number": "string",
      "file": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Нет данных для изменений"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Приложение не найдено"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при обновлении приложения"
    }
    ```

---

## 5. Создание расторжения договора <a id="5-создание-расторжения-договора"></a>

**Описание**: Этот эндпоинт используется для создания расторжения договора. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/termination`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `201 Created`
  - **Тело ответа**:
    ```json
    {
      "appendix_number": "string"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Расторжение соглашения уже существует"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Договор не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при создании расторжения"
    }
    ```

---

## 6. Подтверждение расторжения договора <a id="6-подтверждение-расторжения-договора"></a>

**Описание**: Этот эндпоинт используется для подтверждения расторжения договора. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/termination`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `pdf_key`: Ключ PDF-файла расторжения.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "message": "Расторжение подтверждено"
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Поле 'pdf_key' обязательно"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Расторжение договора не найдено"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при подтверждении расторжения"
    }
    ```

---

## 7. Получение договора по ID артиста <a id="7-получение-договора-по-id-артиста"></a>

**Описание**: Этот эндпоинт используется для получения договора по ID артиста. Доступен только пользователям с ролью `label`.

- **Путь**: `/:id`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist_id": "string",
      "surname": "string",
      "firstname": "string",
      "patronymic": "string",
      "contact": "string",
      "email": "string",
      "id": "string",
      "number": "string",
      "file": "string",
      "percentage": "number",
      "appendices": [
        {
          "id": "string",
          "type": "string",
          "number": "string",
          "file": "string"
        }
      ],
      "status": "string",
      "createdAt": "string"
    }
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Договор не найден"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при получении договора"
    }
    ```

---

## 8. Получение всех договоров <a id="8-получение-всех-договоров"></a>

**Описание**: Этот эндпоинт используется для получения списка всех договоров с возможностью фильтрации, сортировки и пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:
  - `type`: Фильтр по типу приложения (`appendix` или `termination`).
  - `status`: Фильтр по статусу договора (`active` или `terminated`).
  - `sort[contract_number]`: Сортировка по номеру договора (`asc` или `desc`).
  - `sort[createdAt]`: Сортировка по дате создания (`asc` или `desc`).
  - `search`: Поисковый запрос (по номеру договора).
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`, максимум `50`).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "artist_id": "string",
          "surname": "string",
          "firstname": "string",
          "patronymic": "string",
          "contact": "string",
          "email": "string",
          "id": "string",
          "number": "string",
          "file": "string",
          "percentage": "number",
          "appendices": [
            {
              "id": "string",
              "type": "string",
              "number": "string",
              "file": "string"
            }
          ],
          "status": "string",
          "createdAt": "string"
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверные параметры пагинации"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при получении списка договоров"
    }
    ```

---

# Роялти <a id="роялти"></a>

## Базовый URL `/royalties`

## Содержание

1. [Обновление платежной информации](#1-обновление-платежной-информации)
2. [Добавление дохода](#2-добавление-дохода)
3. [Выплата роялти](#3-выплата-роялти)
4. [Блокировка/разблокировка роялти](#4-блокировкаразблокировка-роялти)
5. [Получение роялти артиста](#5-получение-роялти-артиста)
6. [Получение всех активных роялти](#6-получение-всех-активных-роялти)

---

## 1. Обновление платежной информации <a id="1-обновление-платежной-информации"></a>

**Описание**: Этот эндпоинт используется для обновления платежной информации артиста. Доступен только пользователям с ролью `artist`.

- **Путь**: `/:id`
- **Метод**: `PATCH`
- **Уровень доступа**: `artist` (через `access("artist")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `details`: Платежная информация (строка).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist": "string",
      "details": "string",
      "active_income": "number",
      "total_income": "number",
      "status": "string",
      "history": [
        {
          "type": "string",
          "amount": "number",
          "date": "string",
          "period": "string",
          "receipt_key": "string"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Поле 'details' обязательно"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Роялти не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при обновлении платежной информации"
    }
    ```

---

## 2. Добавление дохода <a id="2-добавление-дохода"></a>

**Описание**: Этот эндпоинт используется для добавления дохода артисту. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/income`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `amount`: Сумма дохода (положительное число).
    - `period`: Период дохода (строка).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist": "string",
      "details": "string",
      "active_income": "number",
      "total_income": "number",
      "status": "string",
      "history": [
        {
          "type": "string",
          "amount": "number",
          "date": "string",
          "period": "string",
          "receipt_key": "string"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Поле 'amount' должно быть положительным числом"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Роялти не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при добавлении дохода"
    }
    ```

---

## 3. Выплата роялти <a id="3-выплата-роялти"></a>

**Описание**: Этот эндпоинт используется для выплаты роялти артисту. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/payout`
- **Метод**: `POST`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Тело запроса**:
  - **Формат**: `JSON`
  - **Параметры**:
    - `amount`: Сумма выплаты (положительное число).
    - `receipt_key`: Ключ квитанции (строка).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist": "string",
      "details": "string",
      "active_income": "number",
      "total_income": "number",
      "status": "string",
      "history": [
        {
          "type": "string",
          "amount": "number",
          "date": "string",
          "period": "string",
          "receipt_key": "string"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Выплата возможна только при активном статусе"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Роялти не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при выплате роялти"
    }
    ```

---

## 4. Блокировка/разблокировка роялти <a id="4-блокировкаразблокировка-роялти"></a>

**Описание**: Этот эндпоинт используется для блокировки или разблокировки роялти артиста. Доступен только пользователям с ролью `root`.

- **Путь**: `/:id/block`
- **Метод**: `PATCH`
- **Уровень доступа**: `root` (через `access("root")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "artist": "string",
      "details": "string",
      "active_income": "number",
      "total_income": "number",
      "status": "string",
      "history": [
        {
          "type": "string",
          "amount": "number",
          "date": "string",
          "period": "string",
          "receipt_key": "string"
        }
      ]
    }
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Роялти не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при блокировке/разблокировке роялти"
    }
    ```

---

## 5. Получение роялти артиста <a id="5-получение-роялти-артиста"></a>

**Описание**: Этот эндпоинт используется для получения роялти артиста. Доступен только пользователям с ролью `label`.

- **Путь**: `/:id`
- **Метод**: `GET`
- **Уровень доступа**: `label` (через `access("label")`)
- **Параметры пути**:
  - `id`: ID артиста.
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    [
      {
        "artist": "string",
        "details": "string",
        "active_income": "number",
        "total_income": "number",
        "status": "string",
        "history": [
          {
            "type": "string",
            "amount": "number",
            "date": "string",
            "period": "string",
            "receipt_key": "string"
          }
        ]
      }
    ]
    ```
- **Ответы при ошибках**:
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **404 Not Found**:
    ```json
    {
      "message": "Роялти не найдены"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при получении роялти артиста"
    }
    ```

---

## 6. Получение всех активных роялти <a id="6-получение-всех-активных-роялти"></a>

**Описание**: Этот эндпоинт используется для получения списка всех активных роялти с возможностью пагинации. Доступен только пользователям с ролью `root`.

- **Путь**: `/active`
- **Метод**: `GET`
- **Уровень доступа**: `root` (через `access("root")`)
- **Query параметры**:
  - `page`: Номер страницы (по умолчанию `1`).
  - `limit`: Количество элементов на странице (по умолчанию `10`).
- **Ответ при успехе**:
  - **Статус**: `200 OK`
  - **Тело ответа**:
    ```json
    {
      "data": [
        {
          "artist": "string",
          "details": "string",
          "active_income": "number",
          "total_income": "number",
          "status": "string",
          "history": [
            {
              "type": "string",
              "amount": "number",
              "date": "string",
              "period": "string",
              "receipt_key": "string"
            }
          ]
        }
      ],
      "pagination": {
        "total": "number",
        "totalPages": "number",
        "currentPage": "number",
        "limit": "number"
      }
    }
    ```
- **Ответы при ошибках**:
  - **400 Bad Request**:
    ```json
    {
      "message": "Неверный номер страницы"
    }
    ```
  - **403 Forbidden**:
    ```json
    {
      "message": "Доступ запрещен"
    }
    ```
  - **500 Internal Server Error**:
    ```json
    {
      "message": "Ошибка при получении активных роялти"
    }
    ```
